<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Padlet Clone</title>
    <style>
        :root {
            --padlet-pink: #e91e63;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-gradient);
            background-attachment: fixed;
            margin: 0; padding: 20px; min-height: 100vh;
        }

        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 25px; background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(15px); border-radius: 20px; margin-bottom: 30px; color: white;
        }

        .btn-add {
            background: var(--padlet-pink); color: white; border: none;
            padding: 12px 24px; border-radius: 25px; font-weight: bold; cursor: pointer;
        }

        .btn-admin {
            background: rgba(255,255,255,0.1); color: white; border: 1px solid white;
            padding: 8px 15px; border-radius: 15px; cursor: pointer; margin-right: 10px;
        }

        .board { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; }

        .card {
            background: white; border-radius: 20px; padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15); display: flex; flex-direction: column;
        }

        .card textarea {
            width: 100%; border: none; resize: none; font-size: 16px;
            outline: none; min-height: 120px; background: transparent;
        }

        /* По умолчанию скрываем админ-панель карточки */
        .admin-controls {
            display: none; /* Скрыто для всех */
            justify-content: space-between; align-items: center;
            margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;
        }

        /* Класс, который мы добавим через JS для админа */
        .is-admin .admin-controls { display: flex; }

        .btn-del { background: #ff7675; color: white; border: none; padding: 8px 12px; border-radius: 10px; cursor: pointer; }
    </style>
</head>
<body id="mainBody">

<header>
    <div>
        <h2 style="margin:0">✨ My Board</h2>
        <span id="adminStatus" style="font-size: 12px; opacity: 0.7;">View Mode</span>
    </div>
    <div>
        <button class="btn-admin" id="loginBtn">Admin Login</button>
        <button class="btn-add" id="addBtn">+ New Post</button>
    </div>
</header>

<div class="board" id="board"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, push, onValue, update, remove, onChildAdded, onChildChanged, onChildRemoved } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  // !!! ВСТАВЬТЕ ВАШ CONFIG ТУТ !!!
  const firebaseConfig = {
    apiKey: "ВАШ_API_KEY",
    authDomain: "ВАШ_PROJECT.firebaseapp.com",
    databaseURL: "https://ВАШ_PROJECT.firebaseio.com",
    projectId: "ВАШ_PROJECT_ID",
    storageBucket: "ВАШ_PROJECT.appspot.com",
    messagingSenderId: "ВАШ_ID",
    appId: "ВАШ_APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const cardsRef = ref(db, 'cards');

  let isAdmin = false;
  const ADMIN_PASSWORD = "1234"; // ПОМЕНЯЙТЕ ПАРОЛЬ ТУТ!

  // Функция входа
  document.getElementById('loginBtn').onclick = () => {
    const pass = prompt("Введите пароль админа:");
    if (pass === ADMIN_PASSWORD) {
        isAdmin = true;
        document.getElementById('mainBody').classList.add('is-admin');
        document.getElementById('adminStatus').innerText = "Admin Mode Active";
        document.getElementById('loginBtn').style.display = "none";
        alert("Вы вошли как админ! Теперь вам доступны удаление и цвета.");
    } else {
        alert("Неверный пароль!");
    }
  };

  const board = document.getElementById('board');

  document.getElementById('addBtn').onclick = () => {
    push(cardsRef, { text: "", color: "#ffffff" });
  };

  function renderCard(id, data) {
    let cardEl = document.getElementById(id);
    if (!cardEl) {
        cardEl = document.createElement('div');
        cardEl.id = id;
        cardEl.className = 'card';
        cardEl.innerHTML = `
            <textarea placeholder="Write something..."></textarea>
            <div class="admin-controls">
                <input type="color" class="color-dot">
                <button class="btn-del">Delete</button>
            </div>
        `;
        board.prepend(cardEl);
        
        cardEl.querySelector('.btn-del').onclick = () => {
            if(isAdmin) remove(ref(db, 'cards/' + id));
        };
        
        const area = cardEl.querySelector('textarea');
        area.oninput = (e) => update(ref(db, 'cards/' + id), { text: e.target.value });
        
        const colorInp = cardEl.querySelector('input');
        colorInp.onchange = (e) => update(ref(db, 'cards/' + id), { color: e.target.value });
    }

    const textarea = cardEl.querySelector('textarea');
    if (document.activeElement !== textarea) {
        textarea.value = data.text || "";
    }
    cardEl.style.backgroundColor = data.color || "#ffffff";
    cardEl.querySelector('input').value = data.color || "#ffffff";
  }

  onChildAdded(cardsRef, (snapshot) => renderCard(snapshot.key, snapshot.val()));
  onChildChanged(cardsRef, (snapshot) => renderCard(snapshot.key, snapshot.val()));
  onChildRemoved(cardsRef, (snapshot) => {
    document.getElementById(snapshot.key)?.remove();
  });

</script>
</body>
</html>
